<div class="page">
  <div class="card">

    <h2 class="title">Edit Employee</h2>

    <form [formGroup]="form" (ngSubmit)="save()" class="form">

     
      <div class="form-group">
        <label>Login</label>
        <input type="text" formControlName="login" />

        <small class="error" *ngIf="form.get('login')?.hasError('required') && form.get('login')?.touched">
          Login is required.
        </small>

        <small class="error" *ngIf="form.get('login')?.hasError('pattern') && form.get('login')?.touched">
          Only letters, numbers, _ and - are allowed.
        </small>

        <small class="error" *ngIf="form.get('login')?.hasError('exists')">
          This login is already taken.
        </small>
      </div> 

     
      <div class="form-group">
        <label>Name</label>
        <input type="text" formControlName="name" />

        <small class="error" *ngIf="form.get('name')?.hasError('required') && form.get('name')?.touched">
          Name is required.
        </small>
      </div>

      <div class="form-group">
        <label>CPF</label>
        <input type="text" formControlName="cpf" />

        <small class="error" *ngIf="form.get('cpf')?.hasError('required') && form.get('cpf')?.touched">
          CPF is required.
        </small>

        <small class="error" *ngIf="form.get('cpf')?.hasError('invalidLength')">
          CPF must contain exactly 11 digits.
        </small>

        <small class="error" *ngIf="form.get('cpf')?.hasError('exists')">
          This CPF already exists.
        </small>
      </div>

   
      <div class="form-group">
        <label>Email</label>
        <input type="email" formControlName="email" />

        <small class="error" *ngIf="form.get('email')?.hasError('required') && form.get('email')?.touched">
          Email is required.
        </small>

        <small class="error" *ngIf="form.get('email')?.hasError('email')">
          Invalid email format.
        </small>

        <small class="error" *ngIf="form.get('email')?.hasError('exists')">
          This email is already in use.
        </small>
      </div>

    
      <div class="form-group">
        <label>Password (leave empty to keep current)</label>
        <input type="password" formControlName="password" />

        <small class="error" *ngIf="form.get('password')?.hasError('minlength') && form.get('password')?.touched">
          Minimum 6 characters.
        </small>
      </div>

      
      <div class="form-group">
        <label>Companies</label>

        <div class="company-list">
          <label *ngFor="let company of companies">
            <input
              type="checkbox"
              [checked]="form.value.company_ids.includes(company.id)"
              (change)="toggleCompany(company.id)"
            />
            {{ company.name }}
          </label>
        </div>
      </div>

      
      <small class="error" *ngIf="form?.hasError('requestFailed')">
        Error while updating employee. Try again later.
      </small>

    
      <div class="actions">
        <button class="btn outline" type="button" (click)="cancel()">Cancel</button>
        <button class="btn primary" type="submit" [disabled]="loading">Save</button>
      </div>

    </form>

  </div>
</div>
